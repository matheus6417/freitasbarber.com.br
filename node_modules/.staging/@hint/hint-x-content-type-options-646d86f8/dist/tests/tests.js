"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const generate_html_page_1 = require("hint/dist/src/lib/utils/misc/generate-html-page");
const hint_helpers_1 = require("hint/dist/src/lib/utils/hint-helpers");
const hintRunner = require("@hint/utils-tests-helpers/dist/src/hint-runner");
const pageWithAlternateStylesheet = generate_html_page_1.default('<link rel="  alternate stylesheet " href="test.css">');
const pageWithScript = generate_html_page_1.default(undefined, '<script src="test.js"></script>');
const pageWithStylesheet = generate_html_page_1.default('<link rel="stylesheet" href="test.css">');
const noHeaderErrorMessage = `Response should include 'x-content-type-options' header.`;
const unneededHeaderErrorMessage = `Response should not include unneeded 'x-content-type-options' header.`;
const generateInvalidValueMessage = (value = '') => {
    return `'x-content-type-options' header value should be 'nosniff', not '${value}'.`;
};
const tests = [
    {
        name: `HTML page is served without 'X-Content-Type-Options' header`,
        serverConfig: { '/': '' }
    },
    {
        name: `Script is served without 'X-Content-Type-Options' header`,
        reports: [{ message: noHeaderErrorMessage }],
        serverConfig: {
            '/': pageWithScript,
            '/test.js': ''
        }
    },
    {
        name: `Stylesheet is served without 'X-Content-Type-Options' header`,
        reports: [{ message: noHeaderErrorMessage }],
        serverConfig: {
            '/': pageWithStylesheet,
            '/test.css': ''
        }
    },
    {
        name: `Alternate stylesheet is served without 'X-Content-Type-Options' header`,
        reports: [{ message: noHeaderErrorMessage }],
        serverConfig: {
            '/': pageWithAlternateStylesheet,
            '/test.css': ''
        }
    },
    {
        name: `Resource is specified as a data URI`,
        serverConfig: { '/': generate_html_page_1.default(undefined, '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==">') }
    },
    {
        name: `HTML page is served with the 'X-Content-Type-Options' header`,
        reports: [{ message: unneededHeaderErrorMessage }],
        serverConfig: { '/': { headers: { 'X-Content-Type-Options': 'nosniff' } } }
    },
    {
        name: `Script is served with 'X-Content-Type-Options' header with invalid value`,
        reports: [{ message: generateInvalidValueMessage('invalid') }],
        serverConfig: {
            '/': pageWithScript,
            '/test.js': { headers: { 'X-Content-Type-Options': 'invalid' } }
        }
    }
];
hintRunner.testHint(hint_helpers_1.getHintPath(__filename), tests);
