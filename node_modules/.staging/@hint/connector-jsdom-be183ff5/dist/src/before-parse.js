"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const url_1 = require("url");
const vm = require("vm");
const path = require("path");
const jsdomutils = require("jsdom/lib/jsdom/living/generated/utils");
const read_file_1 = require("hint/dist/src/lib/utils/fs/read-file");
exports.beforeParse = (finalHref) => {
    return (window) => {
        const mutationObserverPolyfill = read_file_1.default(require.resolve('mutationobserver-shim'));
        const customElementsPolyfill = read_file_1.default(path.join(__dirname, 'polyfills', 'custom-elements.min.js'));
        const mutationScript = new vm.Script(mutationObserverPolyfill);
        const customElementsScript = new vm.Script(customElementsPolyfill);
        mutationScript.runInContext(jsdomutils.implForWrapper(window.document)._global);
        customElementsScript.runInContext(jsdomutils.implForWrapper(window.document)._global);
        window.document.domain = new url_1.URL(finalHref).host;
        window.matchMedia = () => {
            return { addListener() { } };
        };
        Object.defineProperty(window.HTMLHtmlElement.prototype, 'clientWidth', { value: 1024 });
        Object.defineProperty(window.HTMLHtmlElement.prototype, 'clientHeight', { value: 768 });
    };
};
